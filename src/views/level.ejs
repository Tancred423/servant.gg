<%- include('partials/header-1') -%>
<!-- Primary Meta Tags -->
<title>Servant | Dashboard: <%= guild.name %> — Moderation: Level</title>
<meta name="title" content="Servant | Dashboard: <%= guild.name %> — Moderation: Level">
<meta name="description" content="Adjust leveling speed and reward users with roles upon level up!">

<!-- SEO -->
<meta name="keywords" content="discord,discordbot,bot,bots,servant,moderation,information,fun,interaction,random,utility,role management,channel management,management,leveling,giveaways,giveaway,polls,poll,level,levels,social interactions,anime,voice management,voice channel,voice,embed,profile,birthday,coinflip,remindme,reminder,timezone">
<meta name="robots" content="index, follow">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="language" content="English">
<meta name="revisit-after" content="30 days">
<meta name="author" content="Tancred#0001">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://servant.gg/<%= guild.id %>/moderation/level">
<meta property="og:title" content="Servant | Dashboard: <%= guild.name %> — Moderation: Level">
<meta property="og:description" content="Adjust leveling speed and reward users with roles upon level up!">
<meta property="og:image" content="https://i.imgur.com/lLuoClj.jpg">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://servant.gg/<%= guild.id %>/moderation/level">
<meta property="twitter:title" content="Servant | Dashboard: <%= guild.name %> — Moderation: Level">
<meta property="twitter:description" content="Adjust leveling speed and reward users with roles upon level up!">
<meta property="twitter:image" content="https://i.imgur.com/lLuoClj.jpg">
<%- include('partials/header-2') -%>
<%- include('partials/nav') -%>
<%- include('partials/nav-highlights/nav-dash') -%>

<script>
    var botRoles = <%- JSON.stringify(botGuild.roles.cache) %>;
</script>

<% let notification_checked = 'checked'; %>
<% let modifier = '1.00'; %>
<% if (guild_levels.length > 0) { %>
<%     notification_checked = guild_levels[0].notification ? 'checked' : ''; %>
<%     modifier = guild_levels[0].modifier; %>
<% } %>

<div class="main-wrapper">
    <div class="dash-user-wrapper">
        <div class="dash-featured">
            <div id="meta"></div>
            <h1>Dashboard:
                <% if (guild.icon === null) { %>
                <img src="/images/no_user.png" alt="Default Server Icon">
                <% } else { %>
                <img src="https://cdn.discordapp.com/icons/<%= guild.id %>/<%= guild.icon %>.png" alt="Server Icon">
                <% } %>
                <%= guild.name %>
            </h1>
            <div class="path"><a href="/">Home</a> > <a href="/dashboard">Dashboard</a> > <a href="/dashboard/<%= guild.id %>"><%= guild.name %></a> > <a href="/dashboard/<%= guild.id %>/moderation">Moderation</a> > <a href="/dashboard/<%= guild.id %>/moderation/level">Level</a></div>
        </div>
        <div class="main-content banner">
            <div class="padding-top padding-bottom padding-left padding-right">
                <div class="global-switch">
                    <div id="dismissible-item-plugins" data-component="dismissible-item" data-type="error" data-value="Error: Couldn't update plugin toggle."></div>
                    <span><i class="fas fa-user-cog"></i> Level Plugin</span>
                    <label class="switch">
                        <input name="<%= guild.id %>" type="checkbox" onclick="submit_plugins(this, 'level')" <%= levelToggle %>>
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
        </div>
        <div class="plugin-sub-featured">
            <!-- <div class="padding-top padding-bottom padding-left padding-right"> -->
            <div class="container">
                <div class="container-title">
                    <div class="left">
                        <h2>Level</h2>
                    </div>
                    <div class="right">
                        <div class="right-left">
                            <span class="circle-label"></span>
                        </div>
                        <div class="right-right">
                            <div class="circle-loader">
                                <div class="checkmark draw"></div>
                                <div class="errormark draw"></div>
                                <div class="errormark2 draw"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <form action="/submit/level" method="POST" id="form_level">
                    <br />

                    <div class="command-panel">
                        <span>Level-up notification</span>
                        <label class="switch">
                            <input name="level-up-msg" id="level-up-msg" type="checkbox" onclick="submit_level()" <%= notification_checked %>>
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <br />

                    <div class="leveling-speed settings-disclaimer">
                        <div>How fast should users gain exp?</div>
                        <br />
                        <div id="scale_display"><%= parseFloat(modifier).toFixed(2) %>x <%= modifier == '1.00' ? ' (recommended)' : '' %></div>
                        <div class="form-group">
                            <input onchange="handle_level_speed();" required type="range" name="level_speed" id="level_speed" min="0.25" max="4.0" step="0.25" value="<%= modifier %>" oninput="level_scale(this);">
                            <label for="level_speed" class="control-label level">Leveling Speed</label><i class="bar"></i>
                        </div>
                    </div>

                    <br />

                    <div class="container1 level settings-disclaimer">
                        <div>Reward users upon a level up with one or more roles. These can be used to climb higher in the member list or unlock channels.</div>

                        <br />
                        <div class="btn-redirect empty center-button" onclick="add_level_role(this);">+ Add</div>
                        <br />

                        <div id="dismissible-item" data-component="dismissible-item" data-type="error" data-value="Error: You cannot set he same role twice."></div>

                        <div id="level-roles">

                            <% let my_level_roles = new Map(); %>

                            <% level_roles.forEach(level_role => {  %>
                            <% if (my_level_roles.has(level_role.level)) { %>
                            <%     my_level_roles.set(level_role.level, my_level_roles.get(level_role.level) + '|' + level_role.role_id); %>
                            <% } else { %>
                            <%     my_level_roles.set(level_role.level, level_role.role_id); %>
                            <% } %>
                            <% }); %>

                            <% let i = 1; %>

                            <% for (const [key, value] of my_level_roles) { %>
                            <% let role_ids = value.split("|"); %>
                            <div class="roles level">
                                <span class="delete-level-role" onclick="delete_level_role(this)"><i class="fas fa-times-circle"></i></span>
                                <input type="number" id="level_<%= i %>" name="level_<%= i %>" placeholder="Level" min="1" max="9999" onkeyup="handle_level(this)" value="<%= key == 0 ? "" : key %>">
                                <select onchange="handle_level_select();" id="level_roles_<%= i %>" name="level_roles_<%= i %>" data-placeholder="Select roles..." multiple class="chosen-select">

                                    <% botGuild.roles.cache.forEach(role => { %>
                                    <%      if (role.name !== "@everyone") { %>
                                    <%          let role_selected = role_ids.includes(role.id) ? 'selected' : ''; %>
                                   
                                    <option style="color: #<%= role.color.toString(16) %>" value="<%= role.id %>" <%= role_selected %>><%= role.name %></option>
                                    <%      } %>
                                    <% }); %>

                                </select>
                            </div>
                            <% i++; %>
                            <% }; %>
                        </div>
                    </div>

                    <!-- to include it in url params -->
                    <input type="hidden" id="guild_id" name="guild_id" value="<%= guild.id %>" />
                </form>
            </div>

            <!-- </div> -->
        </div>
    </div>
</div>

<%- include('partials/footer') -%>
